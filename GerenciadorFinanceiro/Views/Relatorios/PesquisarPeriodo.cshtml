@model GerenciadorFinanceiro.Models.PesquisarPeriodo
@{
    ViewBag.Title = "PesquisarPeriodo";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="~/Scripts/mask/echarts.common.min.js"></script>

@* Grafico receitas/depesas *@
<div class="col-12 row ">
    <div id="categoriaInformacoes" class="col-3 text-center mt-5">
       
        <span style="font-size: 12pt; font-weight:100">Valor total recebido no período: </span>
        <br />
        <span class="text-success" id="valorReceitas" style="font-size:15pt;"></span>
    </div>

    <div id="receitaDespesa" class="bg-white col-6 shadow-lg" style="height:400px;"><img style="height:100%; margin-left:-4%;" src="~/Images/loading.gif" /></div>
    @*<div id="categoriaInformacoes" class="col-6 text-center">
            <span style="font-size: 15pt; font-weight:200">Gráfico por categorias</span>
            <br />
            <span style="font-size: 12pt; font-weight:100">Valor total do período com despesas: R$</span>
        </div>*@

    <div id="categoriaInformacoes" class="col-3 text-center mt-5">
        <span style="font-size: 12pt; font-weight:100">Valor total gasto no  &nbsp &nbsp &nbsp período: </span>
        <br />
        <span class="text-danger" id="valorDespesas" style="font-size:15pt;"></span>
    </div>

</div>

<div class=" row col-12 mt-4">
    @*Gráfico receitas*@
    <div class="row col-12">
        <span class="text-center col-6" style="font-size: 15pt; font-weight:200">Despesas</span>
        <span class="text-center col-6" style="font-size: 15pt; font-weight:200">Receitas</span>
    </div>
    <div class="col-6  ">

        <div id="categoriaDespesa" class=" shadow-lg bg-white " style="height:400px;"><img style="height:100%; margin-left:-4%;" src="~/Images/loading.gif" /></div>




    </div>

    @*Gráfico receitas*@
    <div class="col-6  ">




        <div id="categoriaReceita" class=" shadow-lg bg-white" style="height:400px;"><img style="height:100%; margin-left:-4%;" src="~/Images/loading.gif" /></div>

    </div>
</div>







<script type="text/javascript">

    $.ajax({
        url: "ConsultaCategoria",
        type: "POST",
        data: { inicioVencimento : @Model.inicioVencimento.Year +"-"+@Model.inicioVencimento.Month + "-"+@Model.inicioVencimento.Day, fimvencimento: @Model.fimVencimento.Year +"-"+@Model.fimVencimento.Month + "-"+@Model.fimVencimento.Day , inicioCadastro: @Model.inicioCadastro.Year +"-"+@Model.inicioCadastro.Month + "-"+@Model.inicioCadastro.Day , fimCadastro:@Model.fimCadastro.Year +"-"+@Model.fimCadastro.Month + "-"+@Model.fimCadastro.Day , inicioEmissao:@Model.inicioEmissao.Year +"-"+@Model.inicioEmissao.Month + "-"+@Model.inicioEmissao.Day, fimEmissao:@Model.fimEmissao.Year +"-"+@Model.fimEmissao.Month + "-"+@Model.fimEmissao.Day},
        success: iniciaGraficoCategorias
    });

     @*$.ajax({
        url: "ConsultaClienteFornecedor",
        type: "POST",
        data: { inicioVencimento : @Model.inicioVencimento.Year +"-"+@Model.inicioVencimento.Month + "-"+@Model.inicioVencimento.Day, fimvencimento: @Model.fimVencimento.Year +"-"+@Model.fimVencimento.Month + "-"+@Model.fimVencimento.Day , inicioCadastro: @Model.inicioCadastro.Year +"-"+@Model.inicioCadastro.Month + "-"+@Model.inicioCadastro.Day , fimCadastro:@Model.fimCadastro.Year +"-"+@Model.fimCadastro.Month + "-"+@Model.fimCadastro.Day , inicioEmissao:@Model.inicioEmissao.Year +"-"+@Model.inicioEmissao.Month + "-"+@Model.inicioEmissao.Day, fimEmissao:@Model.fimEmissao.Year +"-"+@Model.fimEmissao.Month + "-"+@Model.fimEmissao.Day},
        success: iniciaGraficoCategorias
    });*@

    function iniciaGraficoCategorias(data) {

        $('.div-branca').removeClass('bg-white shadow-lg');

        if (data.nomes.length == 0) {
            $("#main").html("<h2>Nenhum resultado encontrado para os períodos buscados.<h2>");
        }

        var itensDespesas = [];
        var itensReceitas = [];

        var somaDespesas = 0.0;
        var somaReceitas = 0.0;

        for (i = 0; i < data.nomes.length; i++) {
            if (data.rd[i] == "R") {
                itensReceitas.push({
                    value: parseFloat(data.valores[i].replace(",", ".")).toFixed(2), name: data.nomes[i]
                });
                somaReceitas = (parseFloat(somaReceitas) + parseFloat(data.valores[i].replace(",", "."))).toFixed(2);
            }

            if (data.rd[i] == "D") {
                itensDespesas.push({
                    value: parseFloat(data.valores[i].replace(",", ".")).toFixed(2), name: data.nomes[i]
                });
                somaDespesas = (parseFloat(somaDespesas) + parseFloat(data.valores[i].replace(",", "."))).toFixed(2);
            }

            console.log(somaDespesas + ", soma receitas: " + somaReceitas);
        }
        if (parseFloat(somaDespesas) != 0) {
            $("#valorDespesas").html("R$" + somaDespesas.replace(".", ","));
            $("#valorReceitas").html("R$" + somaReceitas.replace(".", ","));
        }
       
        


        var piePatternImg = new Image();
        piePatternImg.src = '../Images/fundo-grafico.jfif';
        //var bgPatternImg = new Image();
        //bgPatternImg.src = '../Images/money-background.jpg';

       
        var myChartReceitaDespesa = echarts.init(document.getElementById('receitaDespesa'));
        var myChartCategoriaDespesa = echarts.init(document.getElementById('categoriaDespesa'));
        var myChartCategoriaReceita = echarts.init(document.getElementById('categoriaReceita'));


        var itemStyle = {
            normal: {
                opacity: 0.7,
                color: {
                    image: piePatternImg,
                    repeat: 'repeat'
                },
                borderWidth: 3,
                borderColor: '#235894'
            }
        };


        /*
        * INÍCIO GRÁFICO RECEITA/DESPESA
        */
        option = {
            tooltip: {},
            series: [{
                name: 'Movimentação no período com',
                type: 'pie',
                radius: '80%',
                center: ['50%', '50%'],
                selectedMode: 'single',
                selectedOffset: 30,
                clockwise: true,
                label: {
                    normal: {
                        textStyle: {
                            fontSize: 16,
                            color: '#235894'
                        }
                    }
                },
                labelLine: {
                    normal: {
                        lineStyle: {
                            color: '#235894'
                        },
                        smooth: 0.2,
                        length: 10,
                        length2: 20
                    }
                },
                data: [{ value: somaDespesas, name: "Despesas" }, { value: somaReceitas, name: "Receitas" }],
                itemStyle: itemStyle
            }]
        };
        myChartReceitaDespesa.setOption(option);

        /*
        * INÍCIO GRÁFICO DESPESA
        */
        option2 = {
            tooltip: {},
            series: [{
                name: 'Despesa',
                type: 'pie',
                radius: '65%',
                center: ['50%', '50%'],
                selectedMode: 'single',
                selectedOffset: 30,
                clockwise: true,
                label: {
                    normal: {
                        textStyle: {
                            fontSize: 12,
                            color: '#235894'
                        }
                    }
                },
                labelLine: {
                    normal: {
                        lineStyle: {
                            color: '#235894'
                        },
                        smooth: 0.2,
                        length: 12,
                        length2: 20
                    }
                },
                data: itensDespesas,
                itemStyle: itemStyle
            }]
        };
        myChartCategoriaDespesa.setOption(option2);

        /*
        * INÍCIO GRÁFICO DESPESA
        */
        option3 = {
            tooltip: {},
            series: [{
                name: 'Receita',
                type: 'pie',
                radius: '65%',
                center: ['50%', '50%'],
                selectedMode: 'single',
                selectedOffset: 30,
                clockwise: true,
                label: {
                    normal: {
                        textStyle: {
                            fontSize: 12,
                            color: '#235894'
                        }
                    }
                },
                labelLine: {
                    normal: {
                        lineStyle: {
                            color: '#235894'
                        },
                        smooth: 0.2,
                        length: 10,
                        length2: 20
                    }
                },
                data: itensReceitas,
                itemStyle: itemStyle
            }]
        };
        myChartCategoriaReceita.setOption(option3);


    }
</script>

