@model GerenciadorFinanceiro.Models.PesquisarPeriodo
@{
    ViewBag.Title = "PesquisarPeriodo";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="~/Scripts/mask/echarts.common.min.js"></script>

<div class="col-12 row">
    <div id="categoriaGrafico" class="col-6 shadow-lg" style="height:400px;"><img style=" margin:-4%; padding:0px; height: 110%; width: 110%" src="~/Images/loading.gif" /></div>
    <div id="categoriaInformacoes" class="col-6 text-center">
        <span style="font-size: 15pt; font-weight:200">Gráfico por categorias</span>
        <br />
        <span style="font-size: 12pt; font-weight:100">Valor total do período com despesas: R$</span>
    </div>
</div>

<script type="text/javascript">

    $.ajax({
        url: "ConsultaCategoria",
        type: "POST",
        data: { inicioVencimento : @Model.inicioVencimento.Year +"-"+@Model.inicioVencimento.Month + "-"+@Model.inicioVencimento.Day, fimvencimento: @Model.fimVencimento.Year +"-"+@Model.fimVencimento.Month + "-"+@Model.fimVencimento.Day , inicioCadastro: @Model.inicioCadastro.Year +"-"+@Model.inicioCadastro.Month + "-"+@Model.inicioCadastro.Day , fimCadastro:@Model.fimCadastro.Year +"-"+@Model.fimCadastro.Month + "-"+@Model.fimCadastro.Day , inicioEmissao:@Model.inicioEmissao.Year +"-"+@Model.inicioEmissao.Month + "-"+@Model.inicioEmissao.Day, fimEmissao:@Model.fimEmissao.Year +"-"+@Model.fimEmissao.Month + "-"+@Model.fimEmissao.Day},
        success: iniciaGraficoCategorias
    });

     $.ajax({
        url: "ConsultaClienteFornecedor",
        type: "POST",
        data: { inicioVencimento : @Model.inicioVencimento.Year +"-"+@Model.inicioVencimento.Month + "-"+@Model.inicioVencimento.Day, fimvencimento: @Model.fimVencimento.Year +"-"+@Model.fimVencimento.Month + "-"+@Model.fimVencimento.Day , inicioCadastro: @Model.inicioCadastro.Year +"-"+@Model.inicioCadastro.Month + "-"+@Model.inicioCadastro.Day , fimCadastro:@Model.fimCadastro.Year +"-"+@Model.fimCadastro.Month + "-"+@Model.fimCadastro.Day , inicioEmissao:@Model.inicioEmissao.Year +"-"+@Model.inicioEmissao.Month + "-"+@Model.inicioEmissao.Day, fimEmissao:@Model.fimEmissao.Year +"-"+@Model.fimEmissao.Month + "-"+@Model.fimEmissao.Day},
        success: iniciaGraficoCategorias
    });

    function iniciaGraficoCategorias(data) {

        if (data.nomes.length == 0) {
            $("#main").html("<h2>Nenhum resultado encontrado para os períodos buscados.<h2>");
        }

        var itens = [];
        for (i = 0; i < data.nomes.length; i++) {
            itens.push({
                value: parseInt(data.valores[i].replace(",", ".")), name: data.nomes[i] });
        }
        console.log(itens);

       

        // based on prepared DOM, initialize echarts instance
        var myChart = echarts.init(document.getElementById('categoriaGrafico'));

        
        var piePatternImg = new Image();
        piePatternImg.src = '../Images/fundo-grafico.jfif';
        var bgPatternImg = new Image();
        bgPatternImg.src = '../Images/money-background.jpg';

        var itemStyle = {
            normal: {
                opacity: 0.7,
                color: {
                    image: piePatternImg,
                    repeat: 'repeat'
                },
                borderWidth: 3,
                borderColor: '#235894'
            }
        };
        option = {
            // backgroundColor: {
            //    image: bgPatternImg,
            //    repeat: 'repeat'
            //},
            
            title: {
                text: '',
                textStyle: {
                    left: 'flex-end',
                    top: 20,
                    color: '#333',
                    //color: '#235894'
                }
            },
            tooltip: {},
            series: [{
                name: 'pie',
                type: 'pie',
                radius: '60%',
                center: ['50%', '50%'],
                selectedMode: 'single',
                selectedOffset: 30,
                clockwise: true,
                label: {
                    normal: {
                        textStyle: {
                            fontSize: 12,
                            color: '#235894'
                        }
                    }
                },
                labelLine: {
                    normal: {
                        lineStyle: {
                            color: '#235894'
                        },
                        smooth: 0.2,
                        length: 10,
                        length2: 20
                    }
                },
                data: itens,
                color: ["#009", '#900', '#090'],
                itemStyle: itemStyle
            }]
        };
        myChart.setOption(option);

        $(".group0").css("background-color", "#ddd");
    }

</script>

