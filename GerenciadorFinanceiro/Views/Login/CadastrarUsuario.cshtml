@model GerenciadorFinanceiro.Models.CadastrarUsuario
@{
    ViewData["Title"] = "Sistema Catadores - Cadastro Usuário";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script type="text/javascript">
    // busca endereco automaticamente
    function retira_acentos(palavra) {
        com_acento = 'áàãâäéèêëíìîïóòõôöúùûüçÁÀÃÂÄÉÈÊËÍÌÎÏÓÒÕÖÔÚÙÛÜÇ';
        sem_acento = 'aaaaaeeeeiiiiooooouuuucAAAAAEEEEIIIIOOOOOUUUUC';
        nova = '';
        for (i = 0; i < palavra.length; i++) {
            if (com_acento.search(palavra.substr(i, 1)) >= 0) {
                nova += sem_acento.substr(com_acento.search(palavra.substr(i, 1)), 1);
            }
            else {
                nova += palavra.substr(i, 1);
            }
        }
        return nova.toUpperCase();
    }

    function getEndereco() {
        if ($.trim($("#CEP").val()) != "") {

            var cep_code = $("#CEP").val();
            if (cep_code.length <= 0) return;
            $.get("http://apps.widenet.com.br/busca-cep/api/cep.json", { code: cep_code },
                function (result) {
                    if (result.status != 1) {
                        alert(result.message || "Houve um erro desconhecido");
                        return;
                    }
                    $("#Cidade").val(retira_acentos(unescape(result.city)));
                    $("#Bairro").val(unescape(result.district));
                    $("#Rua").val(unescape(result.address));
                    $("#Estado").val(unescape(result.state));
                });
        }
    }
</script>

<style>
    .col-lg-10 {
        margin-bottom: 10px;
    }

    .well {
        margin-bottom: 40px;
    }
</style>

<h2>Cadastro de Usuário</h2>

@using (Html.BeginForm())
{
    <div class="panel panel-primary">
        <div class="panel panel-heading">
            <h3 class="panel-title">Dados do Usuário</h3>
        </div>
        <div class="panel-body" id="dadosusuario">
            <fieldset class="scheduler-border">

                <div class="form-group">
                    @Html.LabelFor(model => model.usuario.nome, new { @class = "col-lg-2 control-label" })
                    <div class="col-lg-10">
                        @Html.TextBoxFor(model => model.usuario.nome, new { @class = "form-control", @placeholder = "Nome Completo", @style = "text-transform:uppercase;" })
                        @Html.ValidationMessageFor(model => model.usuario.nome, null, new { @style = "color: #f00" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.usuario.cpf, new { @class = "col-lg-2 control-label" })
                    <div class="col-lg-10">
                        @Html.TextBoxFor(model => model.usuario.cpf, new { @id = "CPF", @class = "form-control", @placeholder = "___.___.___-__" })
                        @Html.ValidationMessageFor(model => model.usuario.cpf, null, new { @style = "color: #f00" })
                    </div>
                </div>


                <div class="form-group">
                    @Html.LabelFor(model => model.usuario.email, new { @class = "col-lg-2 control-label" })
                    <div class="col-lg-10">
                        @Html.TextBoxFor(model => model.usuario.email, new { @type = "email", @class = "form-control", @placeholder = "email@email.com", @style = "text-transform:uppercase;" })
                        @Html.ValidationMessageFor(model => model.usuario.email, null, new { @style = "color: #f00", @type = "email" })
                        <div id="resultEmail" style="color: red;"></div>
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.usuario.telefone, new { @class = "col-lg-2 control-label" })
                    <div class="col-lg-10">
                        @Html.TextBoxFor(model => model.usuario.telefone, new { @id = "Telefone", @class = "form-control", @placeholder = "(xx) _____-____" })
                        @Html.ValidationMessageFor(model => model.usuario.telefone, null, new { @style = "color: #f00", @type = "tel" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.usuario.permissao, new { @class = "col-lg-2 control-label" })

                    <div class="col-lg-10">
                        <label class="custom-control custom-radio" style="font-weight: normal;">
                            @Html.RadioButtonFor(model => model.usuario.permissao, "Administrador", new { @id = "radio1", @name = "Tipo", @value = "A" })
                            <span class="custom-control-indicator"></span>
                            Administrador
                            <span class="custom-control-description" style="display: none;"></span>
                        </label>
                        <label class="custom-control custom-radio" style="margin-left: 30px; font-weight: normal;">
                            @Html.RadioButtonFor(model => model.usuario.permissao, "Usuário", new { @id = "radio2", @name = "Tipo", @value = "U" })
                            <span class="custom-control-indicator"></span>
                            Usuário
                            <span class="custom-control-description" style="display: none;"></span>
                        </label>
                        @Html.ValidationMessageFor(model => model.usuario.permissao, null, new { @style = "color: #f00" })
                    </div>
                </div>

                <div id="selecionarCooperativas">
                    @Html.LabelFor(model => model.cooperativasNomes, new { @class = "col-md-2 control-label" })
                    <div class="col-md-10">
                        @Html.DropDownListFor(m => m.cooperativaSelecionada, Model.cooperativasNomes.Select(x => new SelectListItem() { Text = x, Value = x, Selected = x == Model.cooperativaSelecionada }), new { @class = "form-control  ", @style = "text-transform:uppercase;" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.usuario.login, new { @class = "col-lg-2 control-label" })
                    <div class="col-lg-10">
                        @Html.TextBoxFor(model => model.usuario.login, new { @class = "form-control", @placeholder = "", @style = "text-transform:uppercase;" })
                        @Html.ValidationMessageFor(model => model.usuario.login, null, new { @style = "color: #f00" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.usuario.senha, new { @class = "col-lg-2 control-label control-label" })
                    <div class="col-lg-10">
                        @Html.TextBoxFor(model => model.usuario.senha, new { @class = "form-control", @type = "password" })
                        @Html.ValidationMessageFor(model => model.usuario.senha, null, new { @style = "color: #f00", @type = "password" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.usuario.confirmar_senha, new { @class = "col-lg-2 control-label" })
                    <div class="col-lg-10">
                        @Html.TextBoxFor(model => model.usuario.confirmar_senha, new { @class = "form-control", @type = "password" })
                        @Html.ValidationMessageFor(model => model.usuario.confirmar_senha, null, new { @style = "color: #f00", @type = "Password" })
                    </div>
                </div>
            </fieldset>
            <div class="well well-sm" style="position: relative; top: 20px;">
                <div class="panel panel-heading">
                    <h3 class="panel-title">Endereço</h3>
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        @Html.LabelFor(model => model.usuario.cep, new { @class = "col-lg-2 control-label" })
                        <div class="col-lg-10">
                            @Html.TextBoxFor(model => model.usuario.cep, new { @id = "CEP", @class = "form-control pt-3", @placeholder = "CEP", @onblur = "getEndereco()" })
                            @Html.ValidationMessageFor(model => model.usuario.cep, null, new { @style = "color: #f00" })
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(model => model.usuario.rua, new { @class = "col-lg-2 control-label" })
                        <div class="col-lg-10">
                            @Html.TextBoxFor(model => model.usuario.rua, new { @id = "Rua", @class = "form-control", @placeholder = "RUA", @style = "text-transform: uppercase;" })
                            @Html.ValidationMessageFor(model => model.usuario.rua, null, new { @style = "color: #f00" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.usuario.numero, new { @class = "col-lg-2 control-label" })
                        <div class="col-lg-10">
                            @Html.TextBoxFor(model => model.usuario.numero, new { @id = "Numero", @class = "form-control", @placeholder = "NÚMERO", @style = "text-transform: uppercase;" })
                            @Html.ValidationMessageFor(model => model.usuario.numero, null, new { @style = "color: #f00" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.usuario.bairro, new { @class = "col-lg-2 control-label" })
                        <div class="col-lg-10">
                            @Html.TextBoxFor(model => model.usuario.bairro, new { @id = "Bairro", @class = "form-control", @placeholder = "Bairro", @style = "text-transform: uppercase;" })
                            @Html.ValidationMessageFor(model => model.usuario.bairro, null, new { @style = "color: #f00" })
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(model => model.usuario.cidade, new { @class = "col-lg-2 control-label" })
                        <div class="col-lg-10">
                            @Html.TextBoxFor(model => model.usuario.cidade, new { @id = "Cidade", @class = "form-control", @placeholder = "Cidade", @style = "text-transform: uppercase;" })
                            @Html.ValidationMessageFor(model => model.usuario.cidade, null, new { @style = "color: #f00" })
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(model => model.usuario.estado, new { @class = "col-lg-2 control-label" })
                        <div class="col-lg-10">
                            @Html.TextBoxFor(model => model.usuario.estado, new { @id = "Estado", @class = "form-control", @placeholder = "Estado", @style = "text-transform: uppercase;" })
                            @Html.ValidationMessageFor(model => model.usuario.estado, null, new { @style = "color: #f00" })
                        </div>
                    </div>

                </div>
            </div>

            @*<div class="well well-sm" style="margin-top: 5px">
                    <div class="panel panel-heading">
                        <h3 class="panel-title">Horários (favor utilizar padrão 24h)</h3>
                    </div>
                    <div id="horarios" class="panel-body">
                        <div id="clonedInput1" class="clonedInput" style="text-align: center; margin:auto; width: 50%; padding: 5px; border-radius: 5px; margin-bottom: 10px; border: 1px solid #77ba94;">
                            <div class="actions" style="margin-bottom: 2px; margin-top: 2px;">
                                <a class="clone" style="font-size:15px; cursor: pointer; color:#77ba94;"><span class="glyphicon glyphicon-plus"></span> ADICIONAR HORÁRIO</a>
                                <img class="remove" src="~/Images/cross.png" width="16" height="16" border="0" style="cursor: pointer; position: relative; float: right;">
                            </div>
                            <hr />
                            <div class="row" style="padding: 2px;">
                                <div class="col-xs-8 col-sm-6">
                                    <div class="row" style="margin-bottom: 10px;">
                                        <label for="inicio" class="col-sm-3 control-label">Início</label>
                                        <input id="inicio" class="form-control-sm" name="horario_inicio" type="text" size="5" placeholder="hh:mm" pattern="([01]?[0-9]|2[0-3]):[0-5][0-9]" />
                                    </div>
                                    <div class="row">
                                        <label for="fim" class="col-sm-3 control-label">Fim</label>
                                        <input id="fim" class="form-control-sm" name="horario_fim" type="text" size="5" placeholder="hh:mm" pattern="([01]?[0-9]|2[0-3]):[0-5][0-9]" />
                                    </div>
                                </div>
                                <div class="col-xs-8 col-sm-6" style="width: 220px; float:left; margin-left: 0px;">
                                    <label for="fim" class="control-label">Descrição</label>
                                    <input id="fim" class="form-control" name="descricao" type="text" placeholder="DESCRIÇÃO" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>*@
            <input type="submit" value="Efetivar Cadastro" class="btn btn-primary" style="margin: 0 auto; float: right;">
        </div>
    </div>
}

<script type="text/javascript">
    (function ($) {
        $(document).ready(function () {
            // validar e-mail
            function validateEmail(email) {
                var re = /^(([^<>()[\]\\.,;:\s@@\"]+(\.[^<>()[\]\\.,;:\s@@\"]+)*)|(\".+\"))@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                return re.test(email);
            }

            $("#Email").on("change", function () {
                if (!validateEmail($("#Email").val())) {
                    $("#resultEmail").text("E-mail inválido!");
                } else {
                    $("#resultEmail").text("");
                }
            })

            // mascaras

            $('#CPF').mask('999.999.999-99');
            $('#Telefone').mask("(99) 9999-99999");
            $('#Telefone').change(function (event) { // mascara dinamica
                var target, phone, element;
                target = (event.currentTarget) ? event.currentTarget : event.srcElement;
                phone = target.value.replace(/\D/g, '');
                element = $(target); element.unmask();
                if (phone.length > 10) {
                    element.mask("(99) 99999-9999");
                }
                else {
                    element.mask("(99) 9999-99999");
                }
            });

            $('#radio1').on("click", function () {
                $("#selecionarCooperativas").hide("slow");
            });
            $('#radio2').on("click", function () {
                $("#selecionarCooperativas").show();
            });

            $("#CEP").mask("99.999-999");


        });
    })(jQuery);
</script>